"use strict";(self.webpackChunkcrypto_flow=self.webpackChunkcrypto_flow||[]).push([[297],{297:(P,f,r)=>{r.r(f),r.d(f,{default:()=>E});var I,s,v,a,p,_,g=r(467),D=r(494),w=(r(170),Object.defineProperty),m=(o,e,i)=>(((o,e,i)=>{e in o?w(o,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[e]=i})(o,"symbol"!=typeof e?e+"":e,i),i),R=(o,e,i)=>{if(!e.has(o))throw TypeError("Cannot "+i)},t=(o,e,i)=>(R(o,e,"read from private field"),i?i.call(o):e.get(o)),h=(o,e,i)=>{if(e.has(o))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(o):e.set(o,i)},c=(o,e,i,n)=>(R(o,e,"write to private field"),n?n.call(o,i):e.set(o,i),i),u=(o,e,i,n)=>({set _(d){c(o,e,d,i)},get _(){return t(o,e,n)}});class E{constructor(e){m(this,"config"),h(this,I,void 0),m(this,"initialized",!1),h(this,s,{}),h(this,v,0),h(this,a,0),h(this,p,[]),h(this,_,void 0),m(this,"noop",()=>{}),this.onInitComplete=e.onInitComplete||this.noop,this.onThemeLoaded=e.onThemeLoaded||this.noop,this.onRollResult=e.onRollResult||this.noop,this.onRollComplete=e.onRollComplete||this.noop,this.onDieRemoved=e.onDieRemoved||this.noop,this.initialized=this.initScene(e)}initScene(e){var i=this;return(0,g.A)(function*(){i.config=e.options,i.onInitComplete()})()}resize(){}loadTheme(){return Promise.resolve()}updateConfig(e){Object.assign(this.config,e)}addNonDie(e){console.log("die",e),clearTimeout(t(this,_));const{id:i,value:n,...d}=e,l={id:i,value:n,config:d};t(this,s)[i]=l,t(this,p).push(setTimeout(()=>{this.handleAsleep(l)},u(this,v)._++*this.config.delay)),c(this,_,setTimeout(()=>{this.onRollComplete()},500))}add(e){console.log("add die"),this.addNonDie(e)}remove(e){console.log("remove die");const i=t(this,s)[e.id];i.hasOwnProperty("d10Instance")&&(delete t(this,s)[i.d10Instance.id],u(this,a)._--),delete t(this,s)[e.id],u(this,a)._--,this.onDieRemoved(e.rollId)}clear(){!Object.keys(t(this,s)).length&&!t(this,a)||(t(this,p).forEach(e=>clearTimeout(e)),Object.values(t(this,s)).forEach(e=>{e.mesh&&e.mesh.dispose()}),c(this,s,{}),c(this,v,0),c(this,a,0))}handleAsleep(e){var i=this;return(0,g.A)(function*(){var n,d;if(e.asleep=!0,yield D.D.getRollResult(e),e.d10Instance||e.dieParent){if(null!=(n=e?.d10Instance)&&n.asleep||null!=(d=e?.dieParent)&&d.asleep){const l=100===e.config.sides?e:e.dieParent,C=10===e.config.sides?e:e.d10Instance;l.value=0===C.value&&0===l.value?100:l.value+C.value,i.onRollResult({rollId:l.config.rollId,value:l.value})}}else 10===e.config.sides&&0===e.value&&(e.value=10),i.onRollResult({rollId:e.config.rollId,value:e.value});u(i,a)._++})()}}I=new WeakMap,s=new WeakMap,v=new WeakMap,a=new WeakMap,p=new WeakMap,_=new WeakMap}}]);